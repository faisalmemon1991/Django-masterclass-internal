{% extends "base.html" %}
{% block title %}Blog | {{post.title}}{% endblock %}

{% block content %}
<div class="container">
    <div class="layout">
      <!-- left layout -->
      <div class="left">
        <div class="page-top">
          <div class="top flex">
            <div class="page-name">
              <a href="{{request.META.HTTP_REFERER}}" class="learn">
                <span class="material-icons"> keyboard_return </span> Go
                back
              </a>
              <h1>Blog</h1>
            </div>
          </div>
        </div>

        <center>
          <div class="typo">
            <h1 class="title blog-title">
              {{post.title}}
            </h1>
            <div class="timeline">
              <div class="track">
                <i class="uil uil-clock"></i>
                <p class="time">{{post.last_updated|date}}</p>
              </div>
              <div class="track">
                <i class="uil uil-users-alt"></i>
                <p class="view-count">{{post.view_count}} views</p>
              </div>
                {% if user.is_authenticated %}
                <form action="{% url 'bookmark_post' post.slug %}" method="POST">
                  {% csrf_token %}
                  <input type="hidden" name="post_id" value="{{post.id}}">
                {% if is_bookmarked %}
                  <button type="submit" name="post_id" value="{{post.id}}" class="btn btn-info">Remove Bookmark</button>
                {% else %}
                  <button type="submit" name="post_id" value="{{post.id}}" class="btn btn-info"><i class="uil uil-bookmark-full"></i><p class="bookmark">Bookmark</p></button>
                {% endif %}
                </form>
                {% else %}
                <a class="btn btn-outline-info" href="{% url 'login' %}?next={{request.path}}">Log in to bookmark this post</a><br>
                {% endif %}
            </div>
          </div>
        </center>
        <section class="mt">
          <div class="container">
            <!-- blog post -->
            <div class="blog-post">
              <div class="post-img blog-img">
                <img src="{{post.image.url}}" alt="" />
              </div>
              <div class="blog-post-content">
                <p>
                  {{post.content}}
                </p>
                <div class="blog-tags">
                  {% for tag in post.tags.all %}
                    <a href="{% url 'tag_page' tag.slug %}" class="tag">{{tag.name}}</a>
                  {% endfor %}
                </div>
                <div class="social-share">
                  <div class="reactions">
                    <div class="likes">
                      {% if user.is_authenticated %}
                      <form action="{% url 'like_post' post.slug %}" method="POST">
                        {% csrf_token %}
                      {% if post_is_liked %}
                        <button type="submit" name="post_id" value="{{post.id}}" class="btn btn-info">Unlike</button>
                      {% else %}
                        <button type="submit" name="post_id" value="{{post.id}}" class="btn btn-info"><i class="uil uil-heart"></i></button>
                      {% endif %}
                      </form>
                      {% else %}
                    <a class="btn btn-outline-info" href="{% url 'login' %}?next={{request.path}}">Log in to like this post</a><br>
                {% endif %}
                      <span>{{ number_of_likes }}</span>
                    </div>
                    <div class="total-comments">
                      <i class="uil uil-comment-alt"></i>
                      <span>{{comments.count}}</span>
                    </div>
                  </div>
{% comment %} 
                  {% if user.is_authenticated %}
                  <form action="{% url 'blogpost_like' object.id %}" method="POST">
                  {% csrf_token %}

                  {% if post_is_liked %}
                  <button type="submit" name="blogpost_id" value="{{object.id}}" class="btn btn-info">Unlike</button>
                  {% else %}
                  <button type="submit" name="blogpost_id" value="{{object.id}}" class="btn btn-info">Like</button>
                  {% endif %}
                  </form>
                {% else %}
                  <a class="btn btn-outline-info" href="{% url 'login' %}?next={{request.path}}">Log in to like this article!</a><br>
                {% endif %}
                <strong class="text-secondary">{{ number_of_likes }} Like{{ number_of_likes|pluralize }}</strong>
   {% endcomment %}

                  <div class="share">
                    <div class="social">
                      <a href="#">
                        <i class="fa-brands fa-facebook-f"></i>
                      </a>
                      <a href="#">
                        <i class="fa-brands fa-instagram"></i>
                      </a>
                      <a href="#">
                        <i class="fa-brands fa-linkedin-in"></i>
                      </a>
                      <a href="#">
                        <i class="fa-brands fa-twitter"></i>
                      </a>
                    </div>
                  </div>
                </div>

                {% for comment in comments  %}
                <!-- comments -->
                <div class="user-comment">
                  <div class="author">
                    <div class="profile-pic">
                      <img src="{{comment.author.profile.profile_image.url}}" alt="" />
                    </div>
                    <div class="details">
                      <p>{{comment.author.first_name}}</p>
                      <small>{{comment.date|date}}</small>
                    </div>
                  </div>
                  <div class="comment-sec-main">
                    <div class="comment-sec">
                      <div class="comment">
                        <p>
                          {{comment.content}}
                        </p>
                      </div>
                      <div class="reply">
                        <a href="#"><i class="uil uil-heart"></i></a>
                        <a href="#">Reply</a>
                      </div>
                    </div>

                    <div class="comment-box">
                      <h3>Reply to post</h3>
                      <p>
                        Your email address will not be published. Required fields
                        are marked<span>*</span>
                      </p>
                      <form method="POST">
                        {% csrf_token %}
                        {{form.content}}
                        <div class="grid-3">
                          <input type="hidden" name="post_id" value="{{post.id}}">
                          <input type="hidden" name="parent" id="parent" value="{{comment.id}}">
                          {{form.name}}
                          {{form.email}}
                          {{form.website}}
                        </div>
        
                        <button class="btn btn-primary rounded">
                          Post Reply
                        </button>
                      </form>
                    </div>
                    

                {% for reply in comment.replies.all %}
                    <div class="public-reply">
                      <div class="author">
                        <div class="profile-pic">
                          <img src="../images/author.svg" alt="" />
                        </div>
                        <div class="details">
                          <p>{{reply.author.first_name}}</p>
                          <small>{{reply.date|date}}</small>
                        </div>
                      </div>
                      <div class="comment">
                        <p>
                          {{reply.content}}
                        </p>
                      </div>
                      {% comment %} <div class="reply">
                        <a href="#"><i class="uil uil-heart"></i></a>
                        <a href="#">Reply</a>
                      </div> {% endcomment %}
                    </div>
                {% endfor %}
                  </div>
                </div>
                {% empty %}
<h4>There are no comments yet.</h4>
                {% endfor %}
              </div>
            </div>
            <div class="comment-box">
              <h3>Leave a Reply</h3>
              <p>
                Your email address will not be published. Required fields
                are marked<span>*</span>
              </p>
              <form method="POST">
                {% csrf_token %}
                {{form.content}}
                <div class="grid-3">
                  <input type="hidden" name="post_id" value="{{post.id}}">
                  {% comment %} <input type="hidden" name="post" id="id_post" value={{post}}> {% endcomment %}
                  {{form.name}}
                  {{form.email}}
                  {{form.website}}
                </div>

                <button class="btn btn-primary rounded">
                  Post comment
                </button>
              </form>
            </div>
          </div>
        </section>
      </div>
      <!-- left layout end -->

            <!-- right layout -->
            <div class="right">
              <div class="block">
                <h2 class="title2">Most recent</h2>

                {% for post in recent_posts %}
                <div class="recent-post">
                  <div class="rounded-img">
                    <img src="{{post.image.url}}" alt="" />
                  </div>
                  <div class="recent-content">
                    <h3>
                      {{post.title}}
                    </h3>
                    <a class="learn" href="#"
                      >Learn more
                      <span class="material-icons"> trending_flat </span></a
                    >
                  </div>
                </div>               
                {% endfor %}
              </div>
      
              <div class="block r-blog">
                <h2 class="title2">Related Blogs</h2>

                {% for related_post in related_posts %}
                 <!-- card -->
                 <a href="{% url 'post_page' related_post.slug %}">
                  <div class="card">
                    <div class="post-img">
                      <img src="{{related_post.image.url}}" alt="" />
                      <div class="tag">Tag name</div>
                    </div>
                    <div class="card-content">
                      <h3>
                      {{related_post.title}}
                      </h3>
                      <div class="author">
                        <div class="profile-pic">
                          <img src="{{related_post.author.profile.profile_image.url}}" alt="" />
                        </div>
                        <div class="details">
                          <p>{{related_post.author.first_name}}</p>
                          <small>{{related_post.last_updated|date}}</small>
                        </div>
                      </div>
                    </div>
                  </div>
                </a>
                <!-- card end-->
                {% endfor %}
              </div>

              <div class="block">
                <h2 class="title2">Top category</h2>
                <div class="card">
                  <h3>
                    A blog title and other stuffs will add here, lso we can
                    incluse.
                  </h3>
                  <p>
                    Lorem ipsum began as scrambled, nonsensical Latin derived from
                    Cicero's 1st-century BC text De Finibus Bonorum et Malorum.
                  </p>
                  <a class="learn" href="#"
                    >Learn more
                    <span class="material-icons"> trending_flat </span></a
                  >
                </div>
                <div class="card">
                  <h3>
                    A blog title and other stuffs will add here, lso we can
                    incluse.
                  </h3>
                  <p>
                    Lorem ipsum began as scrambled, nonsensical Latin derived from
                    Cicero's 1st-century BC text De Finibus Bonorum et Malorum.
                  </p>
                  <a class="learn" href="#"
                    >Learn more
                    <span class="material-icons"> trending_flat </span></a
                  >
                </div>
                <div class="card">
                  <h3>
                    A blog title and other stuffs will add here, lso we can
                    incluse.
                  </h3>
                  <p>
                    Lorem ipsum began as scrambled, nonsensical Latin derived from
                    Cicero's 1st-century BC text De Finibus Bonorum et Malorum.
                  </p>
                  <a class="learn" href="#"
                    >Learn more
                    <span class="material-icons"> trending_flat </span></a
                  >
                </div>
              </div>
              <div class="block">
                <h2 class="title2">Top Tags</h2>
                <div class="blog-tags">

                  {% for tag in tags %}
                    <a href="{% url 'tag_page' tag.slug %}" class="tag">{{tag.name}}</a>
                  {% endfor %}
              
                </div>
              </div>
            </div>
            <!-- right layout end -->

    </div>
  </div>
{% endblock content %}